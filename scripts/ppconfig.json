{"name":"k2","url":"https://k2.170721.xyz","showName":"k2","appid":"com.k2.app","icon":"","iconRound":true,"state":true,"single":true,"injectJq":true,"tauriApi":false,"devbug":true,"version":"0.0.1","preview":"Android","platform":["1-1"],"width":412,"height":915,"desc":"","jsFile":[],"filterCss":"","customJs":"(function() {\n    // 强制声明，确保即使注入多次也不会报错\n    if (window.__K2_INJECTED__) return;\n    window.__K2_INJECTED__ = true;\n\n    // ---------------- [1. PakePlus 官方跳转逻辑] ----------------\n    const hookPakeLinks = () => {\n        const handle = (e) => {\n            const a = e.target.closest('a');\n            if (a && a.href && (a.target === '_blank' || a.href.startsWith('http'))) {\n                e.preventDefault();\n                location.href = a.href;\n            }\n        };\n        document.addEventListener('click', handle, { capture: true });\n        window.open = (url) => { location.href = url; };\n    };\n\n    // ---------------- [2. 移动端 UI 适配 CSS] ----------------\n    const injectStyle = () => {\n        if (document.getElementById('pp-k2-style')) return;\n        const css = `\n            @media screen and (max-width: 900px) {\n                html, body { height: auto !important; overflow-y: auto !important; }\n                #root, .app-container { height: auto !important; min-height: 100vh !important; display: block !important; overflow: visible !important; }\n                header { height: auto !important; flex-direction: column !important; padding: 10px !important; gap: 8px !important; }\n                .header-right { width: 100% !important; flex-wrap: wrap !important; justify-content: center !important; gap: 5px !important; }\n                .header-divider, .refresh-control { display: none !important; }\n                .dashboard-grid { display: grid !important; grid-template-columns: 1fr 1fr !important; gap: 8px !important; }\n                .metric-card { height: 80px !important; }\n                #card-cable.card-cable { grid-column: span 2 !important; height: auto !important; min-height: 70px !important; }\n                #card-cable .metric-value { font-size: 1rem !important; white-space: normal !important; }\n                .filter-dropdown-container { position: static !important; }\n                .panel-header { position: relative !important; }\n                .filter-menu { left: 10px !important; right: 10px !important; width: calc(100% - 20px) !important; max-height: 60vh !important; overflow-y: auto !important; top: 45px !important; z-index: 9999 !important; }\n                .content-split { flex-direction: column !important; height: auto !important; }\n                .log-panel { width: 100% !important; height: 500px !important; border-bottom: 1px solid var(--border-color) !important; margin-bottom: 10px !important; flex: none !important; }\n                .toggle-panel { width: 100% !important; min-width: unset !important; height: 600px !important; flex: none !important; }\n                #resizer { display: none !important; }\n                #btn-ble-bridge, #btn-connect { flex: 1 1 42% !important; }\n            }\n        `;\n        const styleTag = document.createElement(\"style\");\n        styleTag.id = 'pp-k2-style';\n        styleTag.innerText = css;\n        document.head ? document.head.appendChild(styleTag) : document.documentElement.appendChild(styleTag);\n    };\n\n    // ---------------- [3. 蓝牙 HID 核心类定义] ----------------\n    const SERVICE_UUID = \"6e400001-b5a3-f393-e0a9-e50e24dcca9e\";\n    const TX_CHAR_UUID = \"6e400003-b5a3-f393-e0a9-e50e24dcca9e\";\n\n    class VirtualBLEDevice extends EventTarget {\n        constructor() {\n            super();\n            this.productName = \"WITRN K2 (Bluetooth)\";\n            this.opened = false;\n            this.device = null;\n            this.vendorId = 0x1814;\n            this.productId = 0x5060;\n        }\n        async open() {\n            if (!navigator.bluetooth) return alert(\"当前环境不支持蓝牙，请检查 App 权限设置\");\n            try {\n                this.device = await navigator.bluetooth.requestDevice({\n                    filters: [{ services: [SERVICE_UUID] }, { namePrefix: \"WITRN\" }]\n                });\n                this.device.addEventListener('gattserverdisconnected', () => {\n                    this.opened = false;\n                    this.updateUI(false);\n                    if (navigator.hid) navigator.hid.dispatchEvent(new Event(\"disconnect\"));\n                });\n                const server = await this.device.gatt.connect();\n                const service = await server.getPrimaryService(SERVICE_UUID);\n                const char = await service.getCharacteristic(TX_CHAR_UUID);\n                await char.startNotifications();\n                char.addEventListener('characteristicvaluechanged', (e) => {\n                    if (!this.opened) return;\n                    const fakeEvent = new Event(\"inputreport\");\n                    Object.defineProperty(fakeEvent, 'data', { value: e.target.value });\n                    Object.defineProperty(fakeEvent, 'device', { value: this });\n                    this.dispatchEvent(fakeEvent);\n                });\n                this.opened = true;\n                this.updateUI(true);\n            } catch (err) { this.updateUI(false); console.error(err); }\n        }\n        async close() { if (this.device) this.device.gatt.disconnect(); }\n        updateUI(connected) {\n            const btn = document.getElementById('btn-ble-bridge');\n            if (btn) {\n                btn.innerText = connected ? \"断开蓝牙\" : \"蓝牙连接\";\n                btn.style.backgroundColor = connected ? \"var(--danger-color)\" : \"var(--accent-color)\";\n            }\n        }\n        async sendReport() {}\n    }\n\n    // ---------------- [4. 核心执行逻辑] ----------------\n    try {\n        hookPakeLinks();\n        let bleInst = new VirtualBLEDevice();\n\n        // 劫持 WebHID\n        if (navigator.hid) {\n            const oldReq = navigator.hid.requestDevice.bind(navigator.hid);\n            navigator.hid.requestDevice = async (o) => {\n                if (window.__USE_BLE__) return [bleInst];\n                return oldReq(o);\n            };\n        }\n\n        // 强力循环注入\n        const tryRun = () => {\n            injectStyle();\n            const originalBtn = document.getElementById('btn-connect');\n            const container = document.querySelector('.header-right');\n\n            if (originalBtn && container && !document.getElementById('btn-ble-bridge')) {\n                const bleBtn = document.createElement('button');\n                bleBtn.id = 'btn-ble-bridge';\n                bleBtn.className = \"primary-btn\";\n                bleBtn.innerText = '蓝牙连接';\n                bleBtn.style.marginRight = \"8px\";\n                bleBtn.onclick = (e) => {\n                    e.preventDefault();\n                    if (bleInst.opened) { bleInst.close(); } \n                    else {\n                        window.__USE_BLE__ = true;\n                        originalBtn.click();\n                        setTimeout(() => { window.__USE_BLE__ = false; }, 500);\n                    }\n                };\n                container.insertBefore(bleBtn, originalBtn);\n            }\n        };\n\n        // 在 PakePlus 环境下，使用 setInterval 保证 React 渲染后依然能注入\n        setInterval(tryRun, 1500);\n\n    } catch (fatalError) {\n        console.error(\"K2 Injector Fatal:\", fatalError);\n    }\n})();","isHtml":false,"htmlPath":"C:\\Users\\xhyydpc\\Desktop\\k2\\k2.170721.xyz\\k2.170721.xyz","htmlFiles":[],"more":{"windows":{"label":"k2","title":"k2","url":"https://k2.170721.xyz","userAgent":"Mozilla/5.0 (Linux; Android 14; Pixel 6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Mobile Safari/537.36","width":412,"height":915,"theme":"Dark","resizable":true,"fullscreen":false,"maximized":false,"minWidth":400,"minHeight":300,"maxWidth":1920,"maxHeight":1080,"decorations":true,"transparent":false,"titleBarStyle":"Visible","visible":true,"focus":true,"closable":true,"minimizable":true,"maximizable":true,"alwaysOnTop":false,"alwaysOnBottom":false,"center":false,"skipTaskbar":false,"tabbingIdentifier":null,"parent":null,"dragDropEnabled":true,"browserExtensionsEnabled":false,"devtools":true,"contentProtected":false,"hiddenTitle":true,"incognito":false,"proxyUrl":null,"useHttpsScheme":false,"zoomHotkeysEnabled":false,"acceptFirstMouse":false,"create":false,"additionalBrowserArgs":""}},"phone":{"safeArea":{"top":0,"bottom":0,"left":0,"right":0},"header":{"show":false,"title":"","backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","loading":false,"toolBar":false,"toolBarBackgroundColor":"","toolBarColor":"","toolBarFontSize":16,"toolBarFontWeight":"bold"},"siderMenu":{"show":false,"width":0,"backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","title":"","titleColor":"","titleFontSize":16,"titleFontWeight":"bold"},"tabBar":{"show":false,"backgroundColor":"","color":"","activeColor":"","fontSize":16,"fontWeight":"bold","tabBarItem":[]},"webview":{"userAgent":"","javaScriptEnabled":true,"domStorageEnabled":true,"allowFileAccess":true,"loadWithOverviewMode":true,"setSupportZoom":true,"clearCache":true}},"ios":{"name":"k2","showName":"k2","version":"0.0.1","webUrl":"https://k2.170721.xyz","id":"com.k2.app.ios","icon":"./app-icon.png","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":true},"android":{"name":"k2","showName":"k2","version":"0.0.1","webUrl":"https://k2.170721.xyz","id":"com.k2.app.android","icon":"./app-icon.png","input":"./app-icon.png","output":"./res","rounded":true,"copyTo":"./app/src/main/res","androidResDir":"./app/src/main/res","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":true},"desktop":{"name":"k2","showName":"k2","version":"0.0.1","id":"com.k2.app.desktop","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途，否则后果自负）","webUrl":"https://k2.170721.xyz","iconPath":"../app-icon.png","inputPath":"../app-icon.png","tempPath":"./processed-image.png","icnsPath":"../src-tauri/icons/icon.icns","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途，否则后果自负）","isHtml":false,"single":true,"state":true,"injectJq":false,"tauriApi":true,"buildMethod":"local","debug":false}}